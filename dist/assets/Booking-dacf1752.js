import{c as e,_ as a,r as s,j as t,m as i,M as r,C as l,X as n,a as o,p as c,q as d,B as m,u as p,o as x,s as S,t as h,v as u,b as g}from"./index-79744928.js";import{L as N}from"./loader-2-83083298.js";import{S as O}from"./shopping-bag-156a9f2a.js";import{P as v}from"./plus-7b3e796a.js";import{C as y,A as b}from"./calendar-b23defd1.js";import{C as E}from"./check-circle-fcaf3365.js";const T=e("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),j=e("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),f=e("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);function I(e){return new Date(e).toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}const _=s.memo(({locations:e,loading:a,selectedLocation:s,onLocationSelect:l})=>a?t.jsx(N,{className:"mx-auto h-12 w-12 animate-spin text-pink-500"}):t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:e.map(e=>t.jsxs(i.div,{whileHover:{scale:1.02},onClick:()=>l(e.id),className:"p-6 rounded-xl border-2 cursor-pointer transition-all duration-300 "+(s===e.id?"border-pink-500 bg-pink-50 shadow-lg":"border-gray-200 bg-white hover:border-pink-300"),children:[t.jsx(r,{className:"h-8 w-8 text-pink-500 mb-4"}),t.jsx("h3",{className:"font-semibold text-xl text-gray-800 mb-2",children:e.name}),t.jsx("p",{className:"text-gray-600",children:e.address})]},e.id))}));_.displayName="LocationStep";const k=s.memo(({services:e,selectedServices:a,selectedServiceIds:s,loading:r,onServiceSelect:c,onServiceRemove:d})=>r?t.jsx(N,{className:"mx-auto h-12 w-12 animate-spin text-pink-500"}):t.jsxs(t.Fragment,{children:[s.length>0&&t.jsxs("div",{className:"mb-6 bg-pink-50 p-4 rounded-xl border border-pink-200",children:[t.jsxs("h3",{className:"font-semibold text-gray-800 mb-3 flex items-center",children:[t.jsx(O,{className:"h-5 w-5 mr-2 text-pink-500"}),"Servicios seleccionados"]}),t.jsx("div",{className:"space-y-2",children:s.map(s=>{const i=e.find(e=>e.id===s)||a.find(e=>e.id===s);return i?t.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded-lg shadow-sm",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-gray-800",children:i.name||i.title}),t.jsxs("div",{className:"text-sm text-gray-600 flex items-center",children:[t.jsx(l,{className:"h-3 w-3 mr-1"}),i.duration]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("span",{className:"font-bold text-pink-600",children:i.price}),t.jsx("button",{onClick:e=>{e.stopPropagation(),d(i.id)},className:"p-1 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-500",children:t.jsx(n,{className:"h-4 w-4"})})]})]},i.id):null})})]}),t.jsxs("h3",{className:"font-semibold text-gray-800 mb-3 flex items-center",children:[t.jsx(v,{className:"h-5 w-5 mr-2 text-pink-500"}),"Añadir más servicios"]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.map(e=>t.jsxs(i.div,{whileHover:{scale:1.02},onClick:()=>c(e.id),className:"p-6 rounded-xl border-2 cursor-pointer transition-all duration-300 "+(s.includes(e.id)?"border-pink-500 bg-pink-50 shadow-lg":"border-gray-200 bg-white hover:border-pink-300"),children:[t.jsx(o,{className:"h-6 w-6 text-pink-500 mb-2"}),t.jsx("h3",{className:"font-semibold text-gray-800 mb-2",children:e.name}),t.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-600",children:[t.jsxs("span",{children:[t.jsx(l,{className:"h-4 w-4 inline mr-1"}),e.duration]}),t.jsx("span",{className:"font-bold text-pink-600",children:e.price})]})]},e.id))})]}));k.displayName="ServicesStep";const R=s.memo(({availableDates:e,timeSlots:a,selectedDate:s,selectedTime:r,blockedSlots:n,loading:o,onDateSelect:c,onTimeSelect:d})=>t.jsxs("div",{className:"space-y-8",children:[t.jsxs("div",{children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[t.jsx(y,{className:"h-5 w-5 mr-2 text-pink-500"}),"Selecciona una Fecha"]}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 max-h-64 overflow-y-auto pr-2",children:e.map(e=>t.jsx(i.button,{whileHover:{scale:1.02},onClick:()=>c(e.date),className:"p-3 rounded-lg text-left transition-all duration-300 "+(s===e.date?"bg-gradient-to-r from-pink-500 to-rose-500 text-white shadow-lg":"bg-white border"),children:t.jsx("div",{className:"text-sm font-medium capitalize",children:e.display})},e.date))})]}),s&&t.jsxs("div",{children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[t.jsx(l,{className:"h-5 w-5 mr-2 text-pink-500"}),"Selecciona una Hora"]}),o?t.jsx(N,{className:"mx-auto h-8 w-8 animate-spin text-pink-500"}):t.jsx("div",{className:"grid grid-cols-3 md:grid-cols-5 gap-3",children:a.map(e=>{const a=n.includes(e);return t.jsx(i.button,{whileHover:{scale:1.05},onClick:()=>!a&&d(e),disabled:a,className:"p-3 rounded-lg font-medium transition-all duration-300 "+(a?"bg-gray-200 text-gray-400 cursor-not-allowed":r===e?"bg-gradient-to-r from-pink-500 to-rose-500 text-white shadow-lg":"bg-white border"),children:e},e)})})]})]}));R.displayName="DateTimeStep";const A=s.memo(({bookingData:e,locations:a,services:s,selectedServices:i,availableDates:r,onInputChange:l})=>{var n,o;return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-pink-200",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Resumen de tu Reserva"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Sede:"})," ",null==(n=a.find(a=>a.id===e.location))?void 0:n.name]}),t.jsxs("div",{children:[t.jsx("p",{className:"font-semibold mb-2",children:"Servicios:"}),t.jsx("ul",{className:"list-disc pl-5 space-y-1",children:e.services.map(e=>{const a=s.find(a=>a.id===e)||i.find(a=>a.id===e);return a?t.jsxs("li",{children:[a.name||a.title," - ",a.price]},e):null})})]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Fecha:"})," ",null==(o=r.find(a=>a.date===e.date))?void 0:o.display," a las ",e.time]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(f,{className:"h-4 w-4 inline mr-2"}),"Nombre *"]}),t.jsx("input",{type:"text",value:e.name,onChange:e=>l("name",e.target.value),className:"w-full px-4 py-3 border rounded-lg",placeholder:"Tu nombre",required:!0})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(c,{className:"h-4 w-4 inline mr-2"}),"Teléfono *"]}),t.jsx("input",{type:"tel",value:e.phone,onChange:e=>l("phone",e.target.value),className:"w-full px-4 py-3 border rounded-lg",placeholder:"Tu teléfono",required:!0})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(d,{className:"h-4 w-4 inline mr-2"}),"Email *"]}),t.jsx("input",{type:"email",value:e.email,onChange:e=>l("email",e.target.value),className:"w-full px-4 py-3 border rounded-lg",placeholder:"tu@email.com",required:!0})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(j,{className:"h-4 w-4 inline mr-2"}),"Notas"]}),t.jsx("textarea",{value:e.notes,onChange:e=>l("notes",e.target.value),rows:3,className:"w-full px-4 py-3 border rounded-lg",placeholder:"Alergias, preferencias..."})]})]})});A.displayName="PersonalDataStep";const w=s.memo(({onResetBooking:e})=>t.jsxs("div",{className:"text-center",children:[t.jsx(E,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600 mb-8 max-w-md mx-auto",children:"Tu solicitud de reserva ha sido enviada. Recibirás una confirmación por WhatsApp en breve. ¡Gracias por confiar en nosotras!"}),t.jsx(m,{onClick:e,className:"bg-gradient-to-r from-pink-500 to-rose-500 text-white",children:"Hacer Otra Reserva"})]}));w.displayName="ConfirmationStep";const D=(e,a)=>{switch(a.type){case"SET_STEP":return{...e,currentStep:a.payload};case"SET_BOOKING_DATA":return{...e,bookingData:{...e.bookingData,...a.payload}};case"SET_LOCATIONS":return{...e,locations:a.payload};case"SET_SERVICES":return{...e,services:a.payload};case"SET_BLOCKED_SLOTS":return{...e,blockedSlots:a.payload};case"SET_LOADING":return{...e,loading:{...e.loading,...a.payload}};case"RESET_BOOKING":return{...e,currentStep:S.BOOKING.STEPS.LOCATION,bookingData:{location:"",services:[],date:"",time:"",name:"",phone:"",email:"",notes:""},blockedSlots:[]};default:return e}},C={currentStep:S.BOOKING.STEPS.LOCATION,bookingData:{location:"",services:[],date:"",time:"",name:"",phone:"",email:"",notes:""},locations:[],services:[],blockedSlots:[],loading:{locations:!0,services:!0,slots:!1,submit:!1}},L=()=>{const{toast:e}=p(),{selectedServices:r,removeService:l,clearServices:n}=x(),[o,c]=s.useReducer(D,C),{currentStep:d,bookingData:O,locations:v,services:y,blockedSlots:j,loading:f}=o,L=S.BOOKING.TIME_SLOTS,G=s.useCallback(()=>{const e=[],a=new Date;for(let s=1;s<=S.BOOKING.MAX_ADVANCE_DAYS;s++){const t=new Date(a);t.setDate(a.getDate()+s),S.BOOKING.EXCLUDED_DAYS.includes(t.getDay())||e.push({date:t.toISOString().split("T")[0],display:t.toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long"})})}return e},[]),B=s.useMemo(()=>G(),[G]),P=s.useCallback(async()=>{c({type:"SET_LOADING",payload:{locations:!0}});try{const{data:e,error:a}=await h.from("locations").select("*");if(a)throw a;c({type:"SET_LOCATIONS",payload:e})}catch(a){e({title:"Error",description:u.ERRORS.LOAD_LOCATIONS,variant:"destructive",duration:S.TOAST.ERROR_DURATION})}finally{c({type:"SET_LOADING",payload:{locations:!1}})}},[e]),K=s.useCallback(async()=>{c({type:"SET_LOADING",payload:{services:!0}});try{const{data:e,error:a}=await h.from("services").select("*").order("id",{ascending:!0});if(a)throw a;!e||e.length,c({type:"SET_SERVICES",payload:e||[]}),r.length>0&&c({type:"SET_BOOKING_DATA",payload:{services:r.map(e=>e.id)}})}catch(a){e({title:"Error",description:u.ERRORS.LOAD_SERVICES,variant:"destructive",duration:S.TOAST.ERROR_DURATION})}finally{c({type:"SET_LOADING",payload:{services:!1}})}},[e,r]);s.useEffect(()=>{P(),K()},[P,K]);const M=s.useCallback(async(a,s)=>{if(a&&s){c({type:"SET_LOADING",payload:{slots:!0}});try{const{data:e,error:t}=await h.from("bookings").select("booking_time").eq("location_id",a).eq("booking_date",s);if(t)throw t;c({type:"SET_BLOCKED_SLOTS",payload:e.map(e=>e.booking_time)})}catch(t){e({title:"Error",description:u.ERRORS.VERIFY_SLOTS,variant:"destructive",duration:S.TOAST.ERROR_DURATION}),c({type:"SET_BLOCKED_SLOTS",payload:[]})}finally{c({type:"SET_LOADING",payload:{slots:!1}})}}},[e]),U=s.useCallback((e,a)=>{const s={[e]:a};if("date"===e&&(M(O.location,a),s.time=""),"location"===e&&(s.date="",s.time="",c({type:"SET_BLOCKED_SLOTS",payload:[]})),"service"===e){const e=O.services;e.includes(a)?s.services=e.filter(e=>e!==a):s.services=[...e,a]}c({type:"SET_BOOKING_DATA",payload:s})},[O.location,O.services,M]),F=s.useCallback(e=>{c({type:"SET_BOOKING_DATA",payload:{services:O.services.filter(a=>a!==e)}}),l(e)},[O.services,l]),V=s.useCallback(()=>{switch(d){case S.BOOKING.STEPS.LOCATION:return!!O.location;case S.BOOKING.STEPS.SERVICES:return O.services.length>0;case S.BOOKING.STEPS.DATETIME:return!!O.date&&!!O.time;case S.BOOKING.STEPS.PERSONAL_DATA:return!!O.name&&!!O.phone&&!!O.email;default:return!1}},[d,O]),q=s.useCallback(()=>{V()&&c({type:"SET_STEP",payload:d+1})},[d,V]),H=s.useCallback(()=>{d>1&&c({type:"SET_STEP",payload:d-1})},[d]),z=s.useCallback(async()=>{c({type:"SET_LOADING",payload:{submit:!0}});try{if(["name","email","phone","location","date","time","services"].filter(e=>"services"===e?!O[e]||0===O[e].length:!O[e]).length>0)return void e({variant:"destructive",title:u.ERRORS.MISSING_FIELDS,description:u.ERRORS.COMPLETE_REQUIRED,duration:S.TOAST.ERROR_DURATION});const{data:r,error:l}=await h.from("bookings").insert([{location_id:O.location,booking_date:O.date,booking_time:O.time,client_name:O.name,client_phone:O.phone,client_email:O.email,notes:O.notes}]).select();if(l)return e({variant:"destructive",title:"¡Error en la reserva!",description:l.message||u.ERRORS.BOOKING_UNAVAILABLE,duration:S.TOAST.ERROR_DURATION}),M(O.location,O.date),c({type:"SET_BOOKING_DATA",payload:{time:""}}),void c({type:"SET_STEP",payload:S.BOOKING.STEPS.DATETIME});if(!r||0===r.length)throw new Error("No se pudo crear la reserva");if(O.services.length>0&&r&&r.length>0){const e=r[0].id,a=O.services.map(a=>({booking_id:e,service_id:a})),{error:s}=await h.from("booking_services").insert(a)}let o=!1;try{const{data:e,error:i}=await h.from("services").select("name, price").in("id",O.services),{data:r,error:l}=await h.from("locations").select("name").eq("id",O.location).single(),n={to:O.email,subject:"Confirmación de Reserva - Suly Pretty Nails",booking:{name:O.name,date:O.date,time:O.time,location:(null==r?void 0:r.name)||"",services:e||[],phone:O.phone,email:O.email,notes:O.notes}};try{const{data:e,error:a}=await h.functions.invoke("send-booking-confirmation",{body:n});o=!a}catch(s){o=!1}if(!o)try{const s=await(async(e,s,t)=>{const i=await a(()=>import("./index-aff53f72.js"),[]);i.init("7cffOusu25bOzZ63l");const r=s.map(e=>`${e.name} - ${e.price}`).join(", "),l={to_email:e.email,to_name:e.name,booking_date:I(e.date),booking_time:e.time,booking_location:(null==t?void 0:t.name)||"",booking_services:r,client_phone:e.phone,client_notes:e.notes||"Sin notas adicionales"};try{return{success:!0,response:await i.send("service_ljxqynf","service_ljxqynf",l)}}catch(n){return{success:!1,error:n}}})(O,e||[],r);s&&s.success&&(o=!0)}catch(t){}}catch(i){}e({title:u.SUCCESS.BOOKING_CONFIRMED,description:u.INFO.BOOKING_DESCRIPTION.replace("{name}",O.name),duration:S.TOAST.SUCCESS_DURATION}),n(),c({type:"SET_STEP",payload:S.BOOKING.STEPS.CONFIRMATION})}catch(r){e({variant:"destructive",title:"Error inesperado",description:r.message||u.ERRORS.GENERIC,duration:S.TOAST.ERROR_DURATION})}finally{c({type:"SET_LOADING",payload:{submit:!1}})}},[O,e,M,n]),Y=s.useMemo(()=>({[S.BOOKING.STEPS.LOCATION]:"Elige tu Sede",[S.BOOKING.STEPS.SERVICES]:"Selecciona tu Servicio",[S.BOOKING.STEPS.DATETIME]:"Elige Fecha y Hora",[S.BOOKING.STEPS.PERSONAL_DATA]:"Tus Datos Personales",[S.BOOKING.STEPS.CONFIRMATION]:"¡Reserva Realizada!"}[d]||""),[d]);return s.useCallback(()=>{c({type:"RESET_BOOKING"}),n()},[n]),t.jsxs(t.Fragment,{children:[t.jsxs(g,{children:[t.jsx("title",{children:"Reservas - Suly Pretty Nails | Reserva tu Cita Online"}),t.jsx("meta",{name:"description",content:"Reserva tu cita en Suly Pretty Nails (Basauri y Galdakao). Sistema de reservas fácil para todos nuestros servicios."})]}),t.jsx("section",{className:"relative pt-20 pb-16 bg-gradient-to-br from-pink-50 to-rose-100 overflow-hidden",children:t.jsx("div",{className:"relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:t.jsx(i.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},transition:{duration:.8},children:t.jsx("h1",{className:"text-4xl md:text-5xl lg:text-6xl font-bold gradient-text",children:Y})})})}),t.jsx("section",{className:"py-16 bg-white",children:t.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[d<=S.BOOKING.STEPS.PERSONAL_DATA&&t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-12",children:t.jsx("div",{className:"bg-gradient-to-r from-pink-500 to-rose-500 h-2 rounded-full transition-all duration-300",style:{width:(d-1)/3*100+"%"}})}),t.jsxs(i.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},transition:{duration:.5},className:"bg-gray-50 rounded-2xl p-8",children:[d===S.BOOKING.STEPS.LOCATION&&t.jsx(_,{locations:v,loading:f.locations,selectedLocation:O.location,onLocationSelect:e=>U("location",e)}),d===S.BOOKING.STEPS.SERVICES&&t.jsx(k,{services:y,selectedServices:r,selectedServiceIds:O.services,loading:f.services,onServiceSelect:e=>U("service",e),onServiceRemove:F}),d===S.BOOKING.STEPS.DATETIME&&t.jsx(R,{availableDates:B,timeSlots:L,selectedDate:O.date,selectedTime:O.time,blockedSlots:j,loading:f.slots,onDateSelect:e=>U("date",e),onTimeSelect:e=>U("time",e)}),d===S.BOOKING.STEPS.PERSONAL_DATA&&t.jsx(A,{bookingData:O,locations:v,services:y,selectedServices:r,availableDates:B,onInputChange:U}),d===S.BOOKING.STEPS.CONFIRMATION&&t.jsx(w,{onResetBooking:()=>{c({type:"RESET_BOOKING"}),n()}})]},d),d<=S.BOOKING.STEPS.PERSONAL_DATA&&t.jsxs("div",{className:"flex justify-between mt-8",children:[t.jsxs(m,{onClick:H,variant:"outline",disabled:d===S.BOOKING.STEPS.LOCATION,className:"flex items-center space-x-2",children:[t.jsx(T,{className:"h-4 w-4"}),t.jsx("span",{children:"Anterior"})]}),d<S.BOOKING.STEPS.PERSONAL_DATA?t.jsxs(m,{onClick:q,disabled:!V(),className:"bg-gradient-to-r from-pink-500 to-rose-500 text-white flex items-center space-x-2",children:[t.jsx("span",{children:"Siguiente"}),t.jsx(b,{className:"h-4 w-4"})]}):t.jsxs(m,{onClick:z,disabled:f.submit,className:"bg-gradient-to-r from-pink-500 to-rose-500 text-white flex items-center space-x-2",children:[f.submit?t.jsx(N,{className:"h-4 w-4 animate-spin"}):t.jsx(E,{className:"h-4 w-4"}),t.jsx("span",{children:"Confirmar Reserva"})]})]})]})})]})};export{L as default};
