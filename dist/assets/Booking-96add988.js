var e=Object.defineProperty,s=Object.defineProperties,a=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,l=(s,a,t)=>a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,o=(e,s)=>{for(var a in s||(s={}))i.call(s,a)&&l(e,a,s[a]);if(t)for(var a of t(s))r.call(s,a)&&l(e,a,s[a]);return e},n=(e,t)=>s(e,a(t)),c=(e,s,a)=>new Promise((t,i)=>{var r=e=>{try{o(a.next(e))}catch(s){i(s)}},l=e=>{try{o(a.throw(e))}catch(s){i(s)}},o=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,l);o((a=a.apply(e,s)).next())});import{j as d}from"./chunk-660a9970.js";import{r as m}from"./chunk-b06bd742.js";import{H as p}from"./chunk-53cd4001.js";import{u as x,s as h}from"./chunk-fdd0f858.js";import{c as u,M as S,e as N,X as O,P as b,f as g,B as y,u as v,d as E,g as j,s as f,h as T}from"./index-07bd9f2c.js";import{L as k}from"./chunk-49aa39f8.js";import{m as I}from"./chunk-fb64e05f.js";import{S as R}from"./chunk-99a77a43.js";import{P as A}from"./chunk-bd85fee7.js";import{S as _}from"./chunk-50826b32.js";import{C as w,A as D}from"./chunk-b42cf0f2.js";import{C}from"./chunk-e2a168cc.js";import"./chunk-723739b4.js";import"./chunk-c4165804.js";import"./chunk-46171573.js";const G=u("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),L=u("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),P=u("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),B=m.memo(({locations:e,loading:s,selectedLocation:a,onLocationSelect:t})=>s?d.jsx(k,{className:"mx-auto h-12 w-12 animate-spin text-pink-500"}):d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:e.map(e=>d.jsxs(I.div,{whileHover:{scale:1.02},onClick:()=>t(e.id),className:"p-6 rounded-xl border-2 cursor-pointer transition-all duration-300 "+(a===e.id?"border-pink-500 bg-pink-50 shadow-lg":"border-gray-200 bg-white hover:border-pink-300"),children:[d.jsx(S,{className:"h-8 w-8 text-pink-500 mb-4"}),d.jsx("h3",{className:"font-semibold text-xl text-gray-800 mb-2",children:e.name}),d.jsx("p",{className:"text-gray-600",children:e.address})]},e.id))}));B.displayName="LocationStep";const K=m.memo(({services:e,selectedServices:s,selectedServiceIds:a,loading:t,onServiceSelect:i,onServiceRemove:r})=>t?d.jsx(k,{className:"mx-auto h-12 w-12 animate-spin text-pink-500"}):d.jsxs(d.Fragment,{children:[a.length>0&&d.jsxs("div",{className:"mb-6 bg-pink-50 p-4 rounded-xl border border-pink-200",children:[d.jsxs("h3",{className:"font-semibold text-gray-800 mb-3 flex items-center",children:[d.jsx(R,{className:"h-5 w-5 mr-2 text-pink-500"}),"Servicios seleccionados"]}),d.jsx("div",{className:"space-y-2",children:a.map(a=>{const t=e.find(e=>e.id===a)||s.find(e=>e.id===a);return t?d.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded-lg shadow-sm",children:[d.jsxs("div",{children:[d.jsx("h4",{className:"font-medium text-gray-800",children:t.name||t.title}),d.jsxs("div",{className:"text-sm text-gray-600 flex items-center",children:[d.jsx(N,{className:"h-3 w-3 mr-1"}),t.duration]})]}),d.jsxs("div",{className:"flex items-center space-x-3",children:[d.jsx("span",{className:"font-bold text-pink-600",children:t.price}),d.jsx("button",{onClick:e=>{e.stopPropagation(),r(t.id)},className:"p-1 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-500",children:d.jsx(O,{className:"h-4 w-4"})})]})]},t.id):null})})]}),d.jsxs("h3",{className:"font-semibold text-gray-800 mb-3 flex items-center",children:[d.jsx(A,{className:"h-5 w-5 mr-2 text-pink-500"}),"Añadir más servicios"]}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.map(e=>d.jsxs(I.div,{whileHover:{scale:1.02},onClick:()=>i(e.id),className:"p-6 rounded-xl border-2 cursor-pointer transition-all duration-300 "+(a.includes(e.id)?"border-pink-500 bg-pink-50 shadow-lg":"border-gray-200 bg-white hover:border-pink-300"),children:[d.jsx(_,{className:"h-6 w-6 text-pink-500 mb-2"}),d.jsx("h3",{className:"font-semibold text-gray-800 mb-2",children:e.name}),d.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-600",children:[d.jsxs("span",{children:[d.jsx(N,{className:"h-4 w-4 inline mr-1"}),e.duration]}),d.jsx("span",{className:"font-bold text-pink-600",children:e.price})]})]},e.id))})]}));K.displayName="ServicesStep";const M=m.memo(({availableDates:e,timeSlots:s,selectedDate:a,selectedTime:t,blockedSlots:i,loading:r,onDateSelect:l,onTimeSelect:o})=>d.jsxs("div",{className:"space-y-8",children:[d.jsxs("div",{children:[d.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[d.jsx(w,{className:"h-5 w-5 mr-2 text-pink-500"}),"Selecciona una Fecha"]}),d.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 max-h-64 overflow-y-auto pr-2",children:e.map(e=>d.jsx(I.button,{whileHover:{scale:1.02},onClick:()=>l(e.date),className:"p-3 rounded-lg text-left transition-all duration-300 "+(a===e.date?"bg-gradient-to-r from-pink-500 to-rose-500 text-white shadow-lg":"bg-white border"),children:d.jsx("div",{className:"text-sm font-medium capitalize",children:e.display})},e.date))})]}),a&&d.jsxs("div",{children:[d.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[d.jsx(N,{className:"h-5 w-5 mr-2 text-pink-500"}),"Selecciona una Hora"]}),r?d.jsx(k,{className:"mx-auto h-8 w-8 animate-spin text-pink-500"}):d.jsx("div",{className:"grid grid-cols-3 md:grid-cols-5 gap-3",children:s.map(e=>{const s=i.includes(e);return d.jsx(I.button,{whileHover:{scale:1.05},onClick:()=>!s&&o(e),disabled:s,className:"p-3 rounded-lg font-medium transition-all duration-300 "+(s?"bg-gray-200 text-gray-400 cursor-not-allowed":t===e?"bg-gradient-to-r from-pink-500 to-rose-500 text-white shadow-lg":"bg-white border"),children:e},e)})})]})]}));M.displayName="DateTimeStep";const F=m.memo(({bookingData:e,locations:s,services:a,selectedServices:t,availableDates:i,onInputChange:r})=>{var l,c;const{register:p,handleSubmit:h,getFieldError:u,hasFieldError:S,reset:N,errors:O,setValue:y,watch:v}=x();m.useEffect(()=>{y("name",e.name||""),y("phone",e.phone||""),y("email",e.email||""),y("notes",e.notes||"")},[e,y]);const E=v();return m.useEffect(()=>{E.name!==e.name&&r("name",E.name||""),E.phone!==e.phone&&r("phone",E.phone||""),E.email!==e.email&&r("email",E.email||""),E.notes!==e.notes&&r("notes",E.notes||"")},[E,e,r]),d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-pink-200",children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Resumen de tu Reserva"}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("p",{children:[d.jsx("strong",{children:"Sede:"})," ",null==(l=s.find(s=>s.id===e.location))?void 0:l.name]}),d.jsxs("div",{children:[d.jsx("p",{className:"font-semibold mb-2",children:"Servicios:"}),d.jsx("ul",{className:"list-disc pl-5 space-y-1",children:e.services.map(e=>{const s=a.find(s=>s.id===e)||t.find(s=>s.id===e);return s?d.jsxs("li",{children:[s.name||s.title," - ",s.price]},e):null})})]}),d.jsxs("p",{children:[d.jsx("strong",{children:"Fecha:"})," ",null==(c=i.find(s=>s.date===e.date))?void 0:c.display," a las ",e.time]})]})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[d.jsxs("div",{children:[d.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[d.jsx(P,{className:"h-4 w-4 inline mr-2"}),"Nombre *"]}),d.jsx("input",n(o({type:"text"},p("name")),{className:"w-full px-4 py-3 border rounded-lg "+(S("name")?"border-red-500 focus:border-red-500":"border-gray-300 focus:border-pink-500"),placeholder:"Tu nombre"})),S("name")&&d.jsx("p",{className:"mt-1 text-sm text-red-600",children:u("name")})]}),d.jsxs("div",{children:[d.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[d.jsx(b,{className:"h-4 w-4 inline mr-2"}),"Teléfono *"]}),d.jsx("input",n(o({type:"tel"},p("phone")),{className:"w-full px-4 py-3 border rounded-lg "+(S("phone")?"border-red-500 focus:border-red-500":"border-gray-300 focus:border-pink-500"),placeholder:"Tu teléfono"})),S("phone")&&d.jsx("p",{className:"mt-1 text-sm text-red-600",children:u("phone")})]})]}),d.jsxs("div",{children:[d.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[d.jsx(g,{className:"h-4 w-4 inline mr-2"}),"Email *"]}),d.jsx("input",n(o({type:"email"},p("email")),{className:"w-full px-4 py-3 border rounded-lg "+(S("email")?"border-red-500 focus:border-red-500":"border-gray-300 focus:border-pink-500"),placeholder:"tu@email.com"})),S("email")&&d.jsx("p",{className:"mt-1 text-sm text-red-600",children:u("email")})]}),d.jsxs("div",{children:[d.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[d.jsx(L,{className:"h-4 w-4 inline mr-2"}),"Notas"]}),d.jsx("textarea",n(o({},p("notes")),{rows:3,className:"w-full px-4 py-3 border rounded-lg border-gray-300 focus:border-pink-500",placeholder:"Alergias, preferencias..."}))]})]})});F.displayName="PersonalDataStep";const U=m.memo(({onResetBooking:e})=>d.jsxs("div",{className:"text-center",children:[d.jsx(C,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),d.jsx("p",{className:"text-gray-600 mb-8 max-w-md mx-auto",children:"Tu solicitud de reserva ha sido enviada. Recibirás una confirmación por WhatsApp en breve. ¡Gracias por confiar en nosotras!"}),d.jsx(y,{onClick:e,className:"bg-gradient-to-r from-pink-500 to-rose-500 text-white",children:"Hacer Otra Reserva"})]}));U.displayName="ConfirmationStep";const H=(e,s)=>{switch(s.type){case"SET_STEP":return n(o({},e),{currentStep:s.payload});case"SET_BOOKING_DATA":return n(o({},e),{bookingData:o(o({},e.bookingData),s.payload)});case"SET_LOCATIONS":return n(o({},e),{locations:s.payload});case"SET_SERVICES":return n(o({},e),{services:s.payload});case"SET_BLOCKED_SLOTS":return n(o({},e),{blockedSlots:s.payload});case"SET_LOADING":return n(o({},e),{loading:o(o({},e.loading),s.payload)});case"RESET_BOOKING":return n(o({},e),{currentStep:j.BOOKING.STEPS.LOCATION,bookingData:{location:"",services:[],date:"",time:"",name:"",phone:"",email:"",notes:""},blockedSlots:[]});default:return e}},V={currentStep:j.BOOKING.STEPS.LOCATION,bookingData:{location:"",services:[],date:"",time:"",name:"",phone:"",email:"",notes:""},locations:[],services:[],blockedSlots:[],loading:{locations:!0,services:!0,slots:!1,submit:!1}},z=()=>{const{toast:e}=v(),{selectedServices:s,removeService:a,clearServices:t}=E(),[i,r]=m.useReducer(H,V),{currentStep:l,bookingData:o,locations:n,services:x,blockedSlots:u,loading:S}=i,N=j.BOOKING.TIME_SLOTS,O=m.useCallback(()=>{const e=[],s=new Date;for(let a=1;a<=j.BOOKING.MAX_ADVANCE_DAYS;a++){const t=new Date(s);t.setDate(s.getDate()+a),j.BOOKING.EXCLUDED_DAYS.includes(t.getDay())||e.push({date:t.toISOString().split("T")[0],display:t.toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long"})})}return e},[]),b=m.useMemo(()=>O(),[O]),g=m.useCallback(()=>c(void 0,null,function*(){r({type:"SET_LOADING",payload:{locations:!0}});try{const{data:e,error:s}=yield f.from("locations").select("*");if(s)throw s;r({type:"SET_LOCATIONS",payload:e})}catch(s){e({title:"Error",description:T.ERRORS.LOAD_LOCATIONS,variant:"destructive",duration:j.TOAST.ERROR_DURATION})}finally{r({type:"SET_LOADING",payload:{locations:!1}})}}),[e]),R=m.useCallback(()=>c(void 0,null,function*(){r({type:"SET_LOADING",payload:{services:!0}});try{const{data:e,error:a}=yield f.from("services").select("*").order("id",{ascending:!0});if(a)throw a;!e||e.length,r({type:"SET_SERVICES",payload:e||[]}),s.length>0&&r({type:"SET_BOOKING_DATA",payload:{services:s.map(e=>e.id)}})}catch(a){e({title:"Error",description:T.ERRORS.LOAD_SERVICES,variant:"destructive",duration:j.TOAST.ERROR_DURATION})}finally{r({type:"SET_LOADING",payload:{services:!1}})}}),[e,s]);m.useEffect(()=>{g(),R()},[g,R]);const A=m.useCallback((s,a)=>c(void 0,null,function*(){if(s&&a){r({type:"SET_LOADING",payload:{slots:!0}});try{const{data:e,error:t}=yield f.from("bookings").select("booking_time").eq("location_id",s).eq("booking_date",a);if(t)throw t;r({type:"SET_BLOCKED_SLOTS",payload:e.map(e=>e.booking_time)})}catch(t){e({title:"Error",description:T.ERRORS.VERIFY_SLOTS,variant:"destructive",duration:j.TOAST.ERROR_DURATION}),r({type:"SET_BLOCKED_SLOTS",payload:[]})}finally{r({type:"SET_LOADING",payload:{slots:!1}})}}}),[e]),_=m.useCallback((e,s)=>{const a={[e]:s};if("date"===e&&(A(o.location,s),a.time=""),"location"===e&&(a.date="",a.time="",r({type:"SET_BLOCKED_SLOTS",payload:[]})),"service"===e){const e=o.services;e.includes(s)?a.services=e.filter(e=>e!==s):a.services=[...e,s]}r({type:"SET_BOOKING_DATA",payload:a})},[o.location,o.services,A]),w=m.useCallback(e=>{r({type:"SET_BOOKING_DATA",payload:{services:o.services.filter(s=>s!==e)}}),a(e)},[o.services,a]),L=m.useCallback(()=>{switch(l){case j.BOOKING.STEPS.LOCATION:return!!o.location;case j.BOOKING.STEPS.SERVICES:return o.services.length>0;case j.BOOKING.STEPS.DATETIME:return!!o.date&&!!o.time;case j.BOOKING.STEPS.PERSONAL_DATA:return!!o.name&&!!o.phone&&!!o.email;default:return!1}},[l,o]),P=m.useCallback(()=>{L()&&r({type:"SET_STEP",payload:l+1})},[l,L]),z=m.useCallback(()=>{l>1&&r({type:"SET_STEP",payload:l-1})},[l]),q=m.useCallback(()=>c(void 0,null,function*(){r({type:"SET_LOADING",payload:{submit:!0}});try{if(["name","email","phone","location","date","time","services"].filter(e=>"services"===e?!o[e]||0===o[e].length:!o[e]).length>0)return void e({variant:"destructive",title:T.ERRORS.MISSING_FIELDS,description:T.ERRORS.COMPLETE_REQUIRED,duration:j.TOAST.ERROR_DURATION});const{data:a,error:i}=yield f.from("bookings").insert([{location_id:o.location,booking_date:o.date,booking_time:o.time,client_name:o.name,client_phone:o.phone,client_email:o.email,notes:o.notes}]).select();if(i)return e({variant:"destructive",title:"¡Error en la reserva!",description:i.message||T.ERRORS.BOOKING_UNAVAILABLE,duration:j.TOAST.ERROR_DURATION}),A(o.location,o.date),r({type:"SET_BOOKING_DATA",payload:{time:""}}),void r({type:"SET_STEP",payload:j.BOOKING.STEPS.DATETIME});if(!a||0===a.length)throw new Error("No se pudo crear la reserva");if(o.services.length>0&&a&&a.length>0){const e=a[0].id,s=o.services.map(s=>({booking_id:e,service_id:s})),{error:t}=yield f.from("booking_services").insert(s)}const l=n.find(e=>e.id===o.location),c=x.filter(e=>o.services.includes(e.id));try{(yield h(o,c||[],l)).success}catch(s){}e({title:T.SUCCESS.BOOKING_CONFIRMED,description:T.INFO.BOOKING_DESCRIPTION.replace("{name}",o.name),duration:j.TOAST.SUCCESS_DURATION}),t(),r({type:"SET_STEP",payload:j.BOOKING.STEPS.CONFIRMATION})}catch(a){e({variant:"destructive",title:"Error inesperado",description:a.message||T.ERRORS.GENERIC,duration:j.TOAST.ERROR_DURATION})}finally{r({type:"SET_LOADING",payload:{submit:!1}})}}),[o,e,A,t]),Y=m.useMemo(()=>({[j.BOOKING.STEPS.LOCATION]:"Elige tu Sede",[j.BOOKING.STEPS.SERVICES]:"Selecciona tu Servicio",[j.BOOKING.STEPS.DATETIME]:"Elige Fecha y Hora",[j.BOOKING.STEPS.PERSONAL_DATA]:"Tus Datos Personales",[j.BOOKING.STEPS.CONFIRMATION]:"¡Reserva Realizada!"}[l]||""),[l]);return m.useCallback(()=>{r({type:"RESET_BOOKING"}),t()},[t]),d.jsxs(d.Fragment,{children:[d.jsxs(p,{children:[d.jsx("title",{children:"Reservas - Suly Pretty Nails | Reserva tu Cita Online"}),d.jsx("meta",{name:"description",content:"Reserva tu cita en Suly Pretty Nails (Basauri y Galdakao). Sistema de reservas fácil para todos nuestros servicios."})]}),d.jsx("section",{className:"relative pt-20 pb-16 bg-gradient-to-br from-pink-50 to-rose-100 overflow-hidden",children:d.jsx("div",{className:"relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:d.jsx(I.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},transition:{duration:.8},children:d.jsx("h1",{className:"text-4xl md:text-5xl lg:text-6xl font-bold gradient-text",children:Y})})})}),d.jsx("section",{className:"py-16 bg-white",children:d.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[l<=j.BOOKING.STEPS.PERSONAL_DATA&&d.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-12",children:d.jsx("div",{className:"bg-gradient-to-r from-pink-500 to-rose-500 h-2 rounded-full transition-all duration-300",style:{width:(l-1)/3*100+"%"}})}),d.jsxs(I.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},transition:{duration:.5},className:"bg-gray-50 rounded-2xl p-8",children:[l===j.BOOKING.STEPS.LOCATION&&d.jsx(B,{locations:n,loading:S.locations,selectedLocation:o.location,onLocationSelect:e=>_("location",e)}),l===j.BOOKING.STEPS.SERVICES&&d.jsx(K,{services:x,selectedServices:s,selectedServiceIds:o.services,loading:S.services,onServiceSelect:e=>_("service",e),onServiceRemove:w}),l===j.BOOKING.STEPS.DATETIME&&d.jsx(M,{availableDates:b,timeSlots:N,selectedDate:o.date,selectedTime:o.time,blockedSlots:u,loading:S.slots,onDateSelect:e=>_("date",e),onTimeSelect:e=>_("time",e)}),l===j.BOOKING.STEPS.PERSONAL_DATA&&d.jsx(F,{bookingData:o,locations:n,services:x,selectedServices:s,availableDates:b,onInputChange:_}),l===j.BOOKING.STEPS.CONFIRMATION&&d.jsx(U,{onResetBooking:()=>{r({type:"RESET_BOOKING"}),t()}})]},l),l<=j.BOOKING.STEPS.PERSONAL_DATA&&d.jsxs("div",{className:"flex justify-between mt-8",children:[d.jsxs(y,{onClick:z,variant:"outline",disabled:l===j.BOOKING.STEPS.LOCATION,className:"flex items-center space-x-2",children:[d.jsx(G,{className:"h-4 w-4"}),d.jsx("span",{children:"Anterior"})]}),l<j.BOOKING.STEPS.PERSONAL_DATA?d.jsxs(y,{onClick:P,disabled:!L(),className:"bg-gradient-to-r from-pink-500 to-rose-500 text-white flex items-center space-x-2",children:[d.jsx("span",{children:"Siguiente"}),d.jsx(D,{className:"h-4 w-4"})]}):d.jsxs(y,{onClick:q,disabled:S.submit,className:"bg-gradient-to-r from-pink-500 to-rose-500 text-white flex items-center space-x-2",children:[S.submit?d.jsx(k,{className:"h-4 w-4 animate-spin"}):d.jsx(C,{className:"h-4 w-4"}),d.jsx("span",{children:"Confirmar Reserva"})]})]})]})})]})};export{z as default};
