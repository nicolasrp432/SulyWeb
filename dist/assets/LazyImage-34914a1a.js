import{r as e,j as t,n as a}from"./index-79744928.js";const s=new class{constructor(){this.cache=new Map,this.loadingPromises=new Map,this.maxCacheSize=50,this.compressionQuality=.8,this.enableWebP=this.supportsWebP()}supportsWebP(){const e=document.createElement("canvas");return e.width=1,e.height=1,0===e.toDataURL("image/webp").indexOf("data:image/webp")}getOptimizedUrl(e,t={}){const{width:a=800,height:s,quality:i=80,format:r="auto"}=t;if(e.includes("unsplash.com")){const t=new URL(e);return t.searchParams.set("w",a.toString()),s&&t.searchParams.set("h",s.toString()),t.searchParams.set("q",i.toString()),t.searchParams.set("auto","format"),this.enableWebP&&"auto"===r&&t.searchParams.set("fm","webp"),t.toString()}return e}getDevicePixelRatio(){return window.devicePixelRatio||1}calculateOptimalDimensions(e,t,a=1920){const s=this.getDevicePixelRatio(),i=Math.min(e*s,a),r=t?t*s:void 0;return{width:Math.round(i),height:r?Math.round(r):void 0}}async preloadImage(e,t={}){const a=this.getOptimizedUrl(e,t),s=this.getCacheKey(a,t);if(this.cache.has(s))return this.cache.get(s);if(this.loadingPromises.has(s))return this.loadingPromises.get(s);const i=this.loadImage(a,t).then(e=>(this.addToCache(s,e),this.loadingPromises.delete(s),e)).catch(e=>{throw this.loadingPromises.delete(s),e});return this.loadingPromises.set(s,i),i}loadImage(e,t={}){return new Promise((a,s)=>{const i=new Image;this.isExternalUrl(e)&&(i.crossOrigin="anonymous"),i.onload=()=>{const s={url:e,width:i.naturalWidth,height:i.naturalHeight,element:i,loadTime:Date.now(),...t};a(s)},i.onerror=()=>{s(new Error(`Failed to load image: ${e}`))},!1!==t.lazy&&(i.loading="lazy"),i.src=e})}isExternalUrl(e){try{return new URL(e,window.location.origin).origin!==window.location.origin}catch{return!1}}getCacheKey(e,t){return`${e}:${JSON.stringify(t)}`}addToCache(e,t){if(this.cache.size>=this.maxCacheSize){const e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(e,t)}getCachedImage(e,t={}){const a=this.getOptimizedUrl(e,t),s=this.getCacheKey(a,t);return this.cache.get(s)}clearCache(){this.cache.clear(),this.loadingPromises.clear()}getCacheStats(){return{size:this.cache.size,maxSize:this.maxCacheSize,loadingCount:this.loadingPromises.size,hitRate:this.calculateHitRate()}}calculateHitRate(){return this.cache.size>0?.8:0}async preloadImages(e,t={},a){const{batchSize:s=3}=t,i=[];let r=0;for(let n=0;n<e.length;n+=s){const c=e.slice(n,n+s).map(async s=>{try{const i=await this.preloadImage(s,t);return r++,null==a||a(r,e.length),{url:s,success:!0,data:i}}catch(i){return r++,null==a||a(r,e.length),{url:s,success:!1,error:i}}}),o=await Promise.all(c);i.push(...o)}return i}createSrcSet(e,t=[400,800,1200,1600]){return t.map(t=>`${this.getOptimizedUrl(e,{width:t})} ${t}w`).join(", ")}cleanupCache(e=18e5){const t=Date.now();for(const[a,s]of this.cache.entries())t-s.loadTime>e&&this.cache.delete(a)}};setInterval(()=>{s.cleanupCache()},3e5);const i=({src:i,alt:r,className:n,width:c,height:o,sizes:l="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw",quality:h=80,priority:d=!1,enableCache:u=!0,enableWebP:m=!0,retryAttempts:g=2,placeholder:w="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDQwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjZjNmNGY2Ii8+CjxwYXRoIGQ9Ik0yMDAgMTUwYzAtMjcuNjE0IDIyLjM4Ni01MCA1MC01MHM1MCAyMi4zODYgNTAgNTAtMjIuMzg2IDUwLTUwIDUwLTUwLTIyLjM4Ni01MC01MHoiIGZpbGw9IiNkMWQ1ZGIiLz4KPC9zdmc+",onLoad:x,onError:p,...b})=>{const[f,y]=e.useState(!1),[v,I]=e.useState(d),[j,M]=e.useState(!1),[C,z]=e.useState(0),[N,P]=e.useState(0);e.useRef(null);const S=e.useRef(null),D=e.useMemo(()=>({width:c,height:o,quality:h,format:m?"auto":void 0}),[c,o,h,m]),L=e.useMemo(()=>{return i?u?(e=i,t=D,s.getOptimizedUrl(e,t)):i:w;var e,t},[i,D,u,w]),R=e.useMemo(()=>{if(i&&u)return((e,t)=>s.createSrcSet(e,t))(i,[400,800,1200,1600])},[i,u]);e.useEffect(()=>{if(d||v)return;const e=new IntersectionObserver(([t])=>{t.isIntersecting&&(I(!0),e.disconnect())},{threshold:.1,rootMargin:"100px"});return S.current&&e.observe(S.current),()=>e.disconnect()},[d,v]),e.useEffect(()=>{if(!v||!u||f)return;let e=!1;return(async()=>{try{if(s.getCachedImage(i,D)&&!e)return void y(!0);await s.preloadImage(i,{...D,onProgress:t=>{e||P(t)}}),e||(y(!0),P(100))}catch(t){e||U(t)}})(),()=>{e=!0}},[v,i,D,u,f]);const U=e.useCallback(e=>{C<g?setTimeout(()=>{z(e=>e+1),M(!1),y(!1)},1e3*(C+1)):(M(!0),y(!0),null==p||p(e))},[C,g,p]),k=e.useCallback(e=>{y(!0),P(100),null==x||x(e)},[x]),A=e.useCallback(e=>{U(new Error("Image failed to load"))},[U]);return e.useMemo(()=>{if(!S.current)return{width:800,height:600};const e=S.current.getBoundingClientRect();return{width:e.width||800,height:e.height||600}},[]),t.jsxs("div",{ref:S,className:a("relative overflow-hidden bg-gray-100",n),...b,children:[t.jsx("img",{src:w,alt:"",className:a("absolute inset-0 w-full h-full object-cover transition-all duration-500",f?"opacity-0 scale-110 blur-sm":"opacity-100 scale-100 blur-0"),"aria-hidden":"true"}),v&&t.jsx("img",{src:j?w:L,srcSet:j?void 0:R,sizes:l,alt:r,className:a("w-full h-full object-cover transition-all duration-500",f?"opacity-100 scale-100":"opacity-0 scale-95"),onLoad:k,onError:A,loading:d?"eager":"lazy",decoding:"async"}),!f&&v&&!j&&t.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black/10",children:t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"w-10 h-10 border-3 border-pink-200 border-t-pink-500 rounded-full animate-spin"}),N>0&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsxs("span",{className:"text-xs font-medium text-pink-600",children:[Math.round(N),"%"]})})]})}),j&&C>=g&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100",children:t.jsxs("div",{className:"text-center text-gray-500",children:[t.jsx("svg",{className:"w-8 h-8 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})}),t.jsx("p",{className:"text-sm",children:"Error al cargar imagen"})]})}),j&&C<g&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20",children:t.jsxs("div",{className:"text-center text-white",children:[t.jsx("div",{className:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin mx-auto mb-2"}),t.jsxs("p",{className:"text-sm",children:["Reintentando... (",C+1,"/",g,")"]})]})})]})};export{i as L};
